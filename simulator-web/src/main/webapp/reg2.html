<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<link rel="Shortcut Icon" href="images/favicon.ico">
		<title>影院服务运营监管系统-注册</title>

		<meta name="description" content="User login page" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="admin/assets/css/bootstrap.min.css" />
		<link rel="stylesheet" href="admin/assets/font-awesome/4.5.0/css/font-awesome.min.css" />

		<!-- text fonts -->
		<link rel="stylesheet" href="admin/assets/css/fonts.googleapis.com.css" />

		<!-- ace styles -->
		<link rel="stylesheet" href="admin/assets/css/ace.min.css" />

		<!--[if lte IE 9]>
        <link rel="stylesheet" href="assets/css/ace-part2.min.css"/>
        <![endif]-->
		<link rel="stylesheet" href="admin/assets/css/ace-rtl.min.css" />

		<!--[if lte IE 9]>
        <link rel="stylesheet" href="assets/css/ace-ie.min.css"/>
        <![endif]-->

		<!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

		<!--[if lte IE 8]>
        <script src="assets/js/html5shiv.min.js"></script>
        <script src="assets/js/respond.min.js"></script> 
        <script src="js/ieBetter.js"></script>
		</style>	
        <![endif]-->
        
        <style type="text/css">
			.reg-container {
			    width: 475px;
			    margin: 0 auto;
			}
	        strong.str {
	  		  color: #f64242;
			}
        	.light-login {
			    background: url(admin/assets/css/images/bg.png) #DFE0E2 no-repeat center center;
				background-size: cover;
			} 
			#main{position:absolute; 
				top:50%; 
				left:50%; 
				width:420px; 
				height:250px;  
				margin:-125px 0 0 -210px; 
				background:#ffc;
		    }
			.footer,.g_footer {
			    height: 45px;
			    position: fixed;
			    width: 100%;
			    bottom: 0;
			    line-height: 0px;
			    background-color: #090909;
			    font-size: 15px;
			    color: #fff;
			    text-align: center;
			    padding-top:20px;
			}
			.g_footer {
			    position: relative;
			    background-color: #002c53;
			}
        </style>
        <!--[if lte IE 8]>
        <style type="text/css">
        	.light-login { 
				background:url(assets/css/images/bg.png) center center;
				background-size:100% 100%;
				height:900px; 
				width:100%; 
				filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='assets/css/images/bg.png', sizingMethod='scale');
			} 
		</style>	
        <![endif]-->
	</head>

	<body class="login-layout light-login" >
		<div class="main-container">
			<div class="main-content">
				<div class="row">
					<div class="col-sm-10 col-sm-offset-1">
						<div class="reg-container">
							<div class="space-6"></div>
							<div class="loginbar" >
								<div style="height:10px;">
									<span style="color:#69aa46;font-size:30px;float:left;">影院系统</span>
									<font style="line-height: 41px;float:left;color:#428bca;font-size: 30px;">|</font>
									<h3 style="color:#bdb89c;font-size: 22px;float:left;line-height: 8px;font-family:'微软雅黑';">管理台</h3>
									<font style="color: #69aa46;font-size:25px;line-height:95px;float:left;">&nbsp</font>
								</div>
							</div>
							<div style="height: 55px;"></div>
							<div id="vmLogin" class="position-relative">
								<div id="login-box" class="login-box visible widget-box no-border">
									<div class="widget-body">
										<div class="widget-main" style="height: 100%;">
											<h4 class="header blue lighter bigger" style="text-align:center;font-family:'微软雅黑'">
												用户注册
											</h4>
											<div class="space-6"></div>
     <form class="form-horizontal" id="validation-form">  
         <div class="form-group">
			<label class="col-sm-3 control-label no-padding-right" for="id"><strong class="str"> *</strong>用户名：</label>
			<div class="col-sm-9">
				<div class="clearfix">
					<input class="col-xs-12 valid" type="text" name="id" id="id" placeholder="字母开头的3-24位字母、数字、下划线的组合" />
				</div>
			</div>
		 </div>
         <div class="form-group">
			<label class="col-sm-3 control-label no-padding-right" for="password"><strong class="str"> *</strong>密码 ：</label>
			<div class="col-sm-9">
				<div class="clearfix">
					<input class="col-xs-12 valid" type="password" id="password" name="password" placeholder="请输入6-20位字母、数字或标点符号的组合" />
				</div>
			</div>
		 </div>
         <div class="form-group">
			<label class="col-sm-3 control-label no-padding-right" for="password2"><strong class="str"> *</strong>确认密码 ：</label>
			<div class="col-sm-9">
				<div class="clearfix">
					<input class="col-xs-12 valid" type="password" name="password2" placeholder="" />
				</div>
			</div>
		 </div>
         <div class="form-group">
			<label class="col-sm-3 control-label no-padding-right" for="name"><strong class="str"> *</strong>真实姓名：</label>
			<div class="col-sm-9">
				<div class="clearfix">
					<input class="col-xs-12 valid" type="text" name="name" placeholder="请输入真实姓名" />
				</div>
			</div>
		 </div>
         <div class="form-group">
			<label class="col-sm-3 control-label no-padding-right" for="phone"><strong class="str"> *</strong>手机：</label>
			<div class="col-sm-9">
				<div class="clearfix">
					<input class="col-xs-12 valid" type="text" name="phone" placeholder="请输入正确的手机号码 " />
				</div>
			</div>
		 </div>
         <div class="form-group">
			<label class="col-sm-3 control-label no-padding-right" for="qq"><strong class="str"> *</strong>QQ：</label>
			<div class="col-sm-9">
				<div class="clearfix">
					<input class="col-xs-12 valid" type="text" name="qq" placeholder="请输入正确的QQ号码 " />
				</div>
			</div>
		 </div>
         <div class="form-group">
			<label class="col-sm-3 control-label no-padding-right" for="email"><strong class="str"> *</strong>邮箱 ：</label>
			<div class="col-sm-9">
				<div class="clearfix">
					<input class="col-xs-12 valid" type="text" name="email" placeholder="请输入正确的邮箱地址" />
				</div>
			</div>
		 </div>
         <div class="form-group">
			<label class="col-sm-3 control-label no-padding-right" for="companyName"><strong class="str"> *</strong>公司名称 ：</label>
			<div class="col-sm-9">
				<div class="clearfix">
					<input class="col-xs-12 valid" type="text" name="companyName" placeholder="请输入正确的公司名称" />
				</div>
			</div>
		 </div>
		<div class="form-group">
			<label class="col-sm-4 control-label no-padding-right" for="provinceId"><strong class="str"> *</strong> 城市：</label>
			<div class="col-sm-3">
				<select class="col-sm-11" :duplex="model.provinceId" name="provinceId" data-duplex-changed="onProvinceChanged()">
					<option value="">-请选择省-</option>
					<option :for="el in options.provinceId" :attr="{value:el.id}">{{el.name}}</option>
				</select>
			</div>
			<div class="col-sm-3">
				<select class="col-sm-11" :duplex="model.cityId" name="cityId" data-duplex-changed="onCityChanged()">
					<option value="">-请选择市-</option>
					<option :for="el in options.cityId" :attr="{value:el.id}">{{el.name}}</option>
				</select>
			</div>
		</div>
		<div class="space"></div>
		<div class="clearfix" style="width: 301px; position: absolute; ">
			<button id="btnReg" type="button" class="width-35 pull-right btn btn-sm btn-primary">
				<i class="ace-icon fa fa-key"></i>
				<span class="bigger-110">创建账号</span>
			</button>
		</div>
		<div class="space"></div>
		<div class="space-4"></div>
		<div class="clearfix red" style="position: absolute; top: 190px;">
		    <span id="error">&nbsp;</span>
		</div>
	</form>

											<div class="space-6"></div>

										</div><!-- /.widget-main -->

									</div><!-- /.widget-body -->
									<div style="background-color:#428BCA;height:50px;"></div>
								</div><!-- /.login-box -->
							</div>
						</div><!-- /.col -->
					</div><!-- /.row -->
				</div><!-- /.main-content -->
			</div><!-- /.main-container -->
		<!-- basic scripts -->
		</div>
        <script type="text/javascript" src="admin/assets/js/jquery-1.11.3.min.js"></script>
        <script type="text/javascript" src="admin/assets/js/jquery.validate.min.js"></script>
        <script src="js/tools.js"></script>
		<script type="text/javascript">
			//if('ontouchstart' in document.documentElement) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<!-- inline scripts related to this page -->
        <!--[if IE]>
        <script type="text/javascript" src="admin/assets/js/jquery.placeholder.js"></script>
        <script type="text/javascript">
			$(function () {
				// Invoke the plugin
				$('input, textarea').placeholder();
			});
		</script>
        <![endif]-->
<script type="text/javascript">
var biz={
		// 验证表单
		setValid : function() {
			var gotourl=$('#gotourl').val();
			if(typeof gotourl=='undefined'){gotourl='';}
			jQuery.validator.addMethod("isUserId", function(value, element) {  
				 var isUserId =/^[a-zA-Z][a-zA-Z0-9_]*$/;
				 return this.optional(element) || (isUserId.test(value) && value.length>=3 && value.length<=24);    
				}, "请输入以字母开头的3-24位字母、数字、下划线的组合");
			
			jQuery.validator.addMethod("isPassword", function(value, element) {  
				 var isPassword =/^(?:(?=.*[A-Za-z])(?=.*[0-9])|(?=.*[A-Za-z])(?=.*[^A-Za-z0-9])|(?=.*[0-9])(?=.*[^A-Za-z0-9])).{6,20}$/;
				 return this.optional(element) || (isPassword.test(value));  
				}, "请输入6-20位字母、数字或标点符号的组合");
			
			jQuery.validator.addMethod("isSame", function(value, element) {  
				 return this.optional(element) || (value==$('#password').val());  
				}, "两次输入的密码不一致，请重试"); 
			
			jQuery.validator.addMethod("isMobile", function(value, element) {  
				 var mobile = /^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;  
				 return this.optional(element) || (value.length == 11 && mobile.test(value));  
				}, "请正确填写手机号码"); 
				
			jQuery.validator.addMethod("isQQ", function(value, element) {  
				var checkQQ = /^([1-9][0-9]{4,19})$/;  
				 return this.optional(element) || (checkQQ.test(value));  
				}, "请正确填写qq号码"); 
			
			jQuery.validator.addMethod("isEmail", function(value, element) {  
				var isEmail = /^[a-z0-9]+@([a-z0-9]+\.)+[a-z]{2,4}$/i; 
				 return this.optional(element) || (isEmail.test(value));  
				}, "请正确填写邮箱"); 

			
			$('#validation-form').validate({
				errorElement : 'div',
				errorClass : 'help-block',
				focusInvalid : true,
				ignore : "",
				rules : {
					id : {required : true,isUserId:true,remote : {
						type:"post",
			            url:gotourl+"public/notExistUserId",
			            data : {
			            	userId : function (){return $('#id').val();}
			            }
					}},
					password : {required : true,isPassword:true},
					password2 : {required : true,isSame:true},
					name : {required : true},
					phone : {required : true,isMobile : true },
					qq : {required : true,isQQ : true},
					email : {required : true,isEmail : true},
					companyName : {required : true},
				},
				messages : {
					id : {required : "用户名不能为空", remote : "用户名已存在"},
					password : {required : "密码不能为空"},
					password2 : {required : "密码不能为空"},
					name : {required : "真实姓名不能为空"},
					phone : {required : "手机号不能为空"},
					qq : {required : "qq号不能为空"},
					email : {required : "邮箱不能为空"},
					companyName : {required : "公司名称不能为空"},
				},
				highlight : function(e) {
					$(e).closest('.form-group').removeClass('has-info').addClass('has-error');
				},
				success : function(e) {
					$(e).closest('.form-group').removeClass('has-error');//.addClass('has-info');
					$(e).remove();
				},
				errorPlacement : function(error, element) {
					error.insertAfter(element);
				}
			});
		},
}

$(function() {
	biz.setValid();
    $('#btnReg').on('click', function() {
    	if ($('#validation-form').valid()) {
    		var model=$('#validation-form').serializeObject();
    		model={dataItem:model};
	    	var gotourl=$('#gotourl').val();
	    	if(typeof gotourl=='undefined'){gotourl='';}
	        $.ajax({
	            type: 'post',
	            url :gotourl+'public/reg',
	            data: {
	            	'ajaxParams': JSON.stringify(model)
	            },
	            dataType : 'json',
	            success: function (result) {
	            	var message = result.message;
	            	if (result && result.success){
	                	alert('注册成功');
	                	window.location.href =gotourl+ 'login.html';
	                } else {
	                    alert(result.message);
	                }
	            },
	            error: function (err) {
	                console.log(err);
	                alert("登录失败，请稍后再试！");
	            }
	        });
    		return true;
    	}else {
    		return false;
    	}
    });
    $('input').on('keyup', function() {
        $(this).parent().removeClass('error');
    });

    $(document).on('keyup', function(event) {
        if (event.keyCode == "13") {
            //回车执行查询
            $('#btn').click();
        }
    });
   //保存cookies
    function setCookies(key, value, hour) {
    	var time = new Date();
    	time.setTime(time.getTime() + hour * 60 * 60 * 1000);
    	document.cookie = key + '=' + value + ";path=/;expires=" + time.toGMTString();
    }
});
</script>
	</body>
</html>
